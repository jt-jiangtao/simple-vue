{"version":3,"file":"vue.js","sources":["../../src/observer/array.js","../../src/utils.js","../../src/observer/dep.js","../../src/observer/index.js","../../src/observer/watcher.js","../../src/state.js","../../src/compiler/parse.js","../../src/compiler/generate.js","../../src/compiler/index.js","../../src/vdom/patch.js","../../src/lifecycle.js","../../src/init.js","../../src/vdom/index.js","../../src/initGlobalAPI/index.js","../../src/index.js"],"sourcesContent":["// 我要重写数组的那些方法 7个 push shift unshift pop reverse sort splice 会导致数组本身发生变化\r\n// slice()\r\n\r\n// 拿到数组原型上的方法（原来的方法）\r\nlet oldArrayMethods = Array.prototype;\r\n// value.__proto__ = arrayMethods 原型链查找的问题， 会向上查找，先查找我重写的，重写的没有会继续向上查找\r\n// arrayMethods.__proto__ = oldArrayMethods\r\n// Object.create 创建新对象，并使用原有的对象来提供新创建的对象的__proto__\r\nexport const arrayMethods = Object.create(oldArrayMethods);\r\n\r\nconst methods = [\r\n    'push',\r\n    'shift',\r\n    'unshift',\r\n    'pop',\r\n    'sort',\r\n    'splice',\r\n    'reverse'\r\n]\r\n\r\nmethods.forEach(method => {\r\n    arrayMethods[method] = function (...args){\r\n        // 当调用劫持后的方法 页面应该更新\r\n\r\n\r\n        console.log(\"array-->\")\r\n        // this谁调用该方法this为谁\r\n        // this为Observer中的data\r\n        const result = oldArrayMethods[method].apply(this, arguments);\r\n        let inserted;\r\n\r\n        let ob = this.__ob__\r\n        switch (method) {\r\n            // 新增时可能会存在Object\r\n            case 'push':\r\n            case 'unshift':\r\n                inserted = args;\r\n                break;\r\n            case 'splice': // vue.$set原理\r\n                args.slice(2); // arr.splice(0, 1, {a: 1})\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        if (inserted) ob.observeArray(inserted);\r\n        ob.dep.notify()\r\n        return result;\r\n    }\r\n})","export function proxy(vm, data, key) {\r\n    Object.defineProperty(vm, key, {\r\n        get(){\r\n            return vm[data][key]\r\n        },\r\n        set(newValue){\r\n            vm[data][key] = newValue\r\n        }\r\n    })\r\n}\r\n\r\nexport function defineProperty(data, key, value){\r\n    Object.defineProperty(data, key,{\r\n        enumerable: false, // 不能被枚举，不能被循环出来 for...in\r\n        configurable: false, // delete\r\n        value,\r\n        writable: false\r\n    })\r\n}\r\n\r\nconst LIFECYCLE_HOOKS = [\r\n    'beforeCreate',\r\n    'created',\r\n    'beforeMount',\r\n    'mounted',\r\n    'beforeUpdate',\r\n    'updated',\r\n    'beforeDestroy',\r\n    'destroyed'\r\n]\r\n\r\nlet strats = {}\r\n\r\nfunction mergeHook(parentVal, childVal){\r\n    if(childVal){\r\n        if(parentVal){\r\n            return parentVal.concat(childVal);\r\n        }else{\r\n            return [childVal];\r\n        }\r\n    }else{\r\n        return parentVal;\r\n    }\r\n}\r\n\r\nLIFECYCLE_HOOKS.forEach(hook=>{\r\n    strats[hook] = mergeHook\r\n})\r\n\r\nexport function mergeOptions(parent, child){\r\n    const options = {}\r\n    for(let key in parent){\r\n        mergeField(key)\r\n    }\r\n    for (let key in child){\r\n        if (!parent.hasOwnProperty(key)){\r\n            mergeField(key)\r\n        }\r\n    }\r\n    // 浅合并\r\n    function mergeField(key){\r\n        if (strats[key]){\r\n            return options[key] = strats[key](parent[key], child[key])\r\n        }\r\n        if (typeof parent[key] === 'object' && typeof  child[key] === 'object'){\r\n            options[key] = {\r\n                ...parent[key],\r\n                ...child[key]\r\n            }\r\n        }else if (child[key] == null){\r\n            options[key] = parent[key]\r\n        }else {\r\n            options[key] = child[key]\r\n        }\r\n    }\r\n    return options\r\n}\r\n\r\nlet callbacks = []\r\n\r\nfunction flushCallbacks() {\r\n    while (callbacks.length){\r\n        let cb = callbacks.pop()\r\n        cb()\r\n    }\r\n    pending = false\r\n}\r\nlet timerFunc;\r\nif (Promise) {\r\n    timerFunc = () => {\r\n        Promise.resolve().then(flushCallbacks)\r\n    };\r\n} else if (MutationObserver) { // 可以监控dom变化，监控完毕后异步更新\r\n    let observe = new MutationObserver(flushCallbacks)\r\n    let textNode = document.createTextNode(1)\r\n    observe.observe(textNode, {characterData: true})\r\n    timerFunc = () => {\r\n        textNode.textContent = 2\r\n    }\r\n}else if (setImmediate){\r\n    timerFunc = ()=>{\r\n        setImmediate(flushCallbacks)\r\n    }\r\n}else {\r\n    timerFunc = ()=>{\r\n        setTimeout(flushCallbacks)\r\n    }\r\n}\r\nlet pending = false\r\n// 核心为异步方法\r\nexport function nextTick(cb){\r\n    callbacks.push(cb)\r\n    if (!pending){\r\n        timerFunc();\r\n        pending = true\r\n    }\r\n}\r\n","let id = 0;\r\nclass Dep { // 收集模板中的{{}}对应的watcher\r\n    constructor() {\r\n        // watcher去重\r\n        this.subs = []\r\n        this.id = id ++\r\n    }\r\n\r\n    // 渲染时调用收集依赖，一个渲染位对应一个dep\r\n    depend() {\r\n        // this.subs.push(Dep.target) // 这样出现多个{{name}}时，会保存多次，更新name时会重复渲染多次\r\n        Dep.target.addDep(this)\r\n    }\r\n\r\n    addSub(watcher){\r\n        this.subs.push(watcher)\r\n    }\r\n\r\n    notify(){\r\n        this.subs.forEach(watcher => watcher.update())\r\n    }\r\n}\r\n\r\n// 多对多大关系 一个属性有一个dep是用来收集watcher的\r\n// dep可以存多个watcher vm.$watch('name')\r\n// 一个watcher可以对应多个dep\r\n\r\nDep.target = null;\r\nlet stack = []\r\nexport function pushTarget(watcher){\r\n    Dep.target = watcher\r\n    stack.push(watcher)\r\n}\r\n\r\nexport function popTarget(){\r\n    stack.pop()\r\n    Dep.target = stack[stack.length - 1] // 渲染完成后将target删除\r\n}\r\n\r\nexport default Dep\r\n","import {arrayMethods} from \"./array\";\r\nimport {defineProperty} from \"../utils\";\r\nimport Dep from \"./dep\";\r\n\r\n\r\nclass Observer {\r\n    constructor(data) {\r\n        this.dep = new Dep()\r\n\r\n        // 判断一个对象是否被观测过: 是否含有__ob__属性\r\n\r\n        defineProperty(data, '__ob__' , this);\r\n\r\n        // data.__ob__ = this\r\n\r\n        // 使用defineProperty重新定义属性\r\n        if (Array.isArray(data)) {\r\n            // push shift unshift splice sort reverse pop\r\n            // 函数劫持 切片编程\r\n            data.__proto__ = arrayMethods;\r\n            // 观测数组中的对象类型\r\n            this.observeArray(data)\r\n        }else {\r\n            this.walk(data);\r\n        }\r\n    }\r\n\r\n    walk(data) {\r\n        let keys = Object.keys(data);\r\n        keys.forEach(key=>{\r\n            defineReactive(data, key, data[key]); // 将数据定义为响应式数据\r\n        })\r\n    }\r\n\r\n    observeArray(data) {\r\n        data.forEach(item => {\r\n            observe(item)\r\n        })\r\n    }\r\n\r\n}\r\n\r\nfunction defineReactive(data, key, value) {\r\n    // 获取到数组对应的dep\r\n    let childDep = observe(value)\r\n\r\n    let dep = new Dep() // 每个属性都有dep\r\n\r\n    Object.defineProperty(data, key, {\r\n        get(){ // 依赖收集\r\n            console.log(\"get---> \", key)\r\n            if (Dep.target){\r\n                dep.depend()\r\n                if (childDep){\r\n                    // 默认给数组和对象增加了dep属性\r\n                    childDep.dep.depend()\r\n                }\r\n            }\r\n            // 注意引用\r\n            return value\r\n        },\r\n        set(newValue){ // 依赖更新\r\n            console.log(\"set---> \", key, newValue)\r\n            if (newValue === value) return;\r\n            observe(newValue)\r\n            value = newValue;\r\n\r\n            dep.notify()\r\n        }\r\n    })\r\n}\r\n\r\n// 只观测原来存在的数据\r\nexport function observe(data) {\r\n    // typeof null 也是object\r\n\r\n    // 不能不是对象，并且不是null\r\n    if (typeof data !== 'object' || data === null) {\r\n        return;\r\n    }\r\n    if (data.__ob__) return data;\r\n    return new Observer(data);\r\n}","import {popTarget, pushTarget} from \"./dep\";\r\nimport {nextTick} from \"../utils\";\r\n\r\nlet id = 0\r\n\r\n// watcher负责渲染\r\nclass Watcher {\r\n    constructor(vm, exprOrFn, cb, options) {\r\n        this.vm = vm;\r\n        this.exprOrFn = exprOrFn;\r\n        this.cb = cb;\r\n        this.options = options\r\n        this.user = options.user // 这是一个用户watcher\r\n        this.isWatcher = typeof options === 'boolean'\r\n        this.id = id++ // watcher的唯一标识\r\n        this.deps = []\r\n        this.depsId = new Set()\r\n        this.lazy = options.lazy // lazy不可变\r\n        this.dirty = this.lazy // dirty可变\r\n\r\n        // 如果是渲染watcher那么exprOrFn为重新渲染函数\r\n        // 用户watcher的话为key即属性名称\r\n        if (typeof exprOrFn == 'function') {\r\n            this.getter = exprOrFn\r\n        }else {\r\n            this.getter = function (){ // 可能传递过来的是一个字符串w\r\n                // 当去当前示例上取值时 才会触发依赖收集\r\n                let path = exprOrFn.split('.')\r\n                let obj = vm\r\n                for (let i = 0; i < path.length; i++) {\r\n                    obj = obj[path[i]]\r\n                }\r\n                // obj为old value\r\n                return obj\r\n            }\r\n        }\r\n\r\n        // 默认先调用一次get方法 进行取值 将结果保留\r\n        this.value = this.lazy ? void 0 : this.get()\r\n    }\r\n\r\n    get() {\r\n        pushTarget(this)\r\n        let result = this.getter.call(this.vm) // 渲染页面要取值，get方法\r\n        popTarget()\r\n        return result\r\n    }\r\n\r\n    update() {\r\n\r\n        if (this.lazy){\r\n            this.dirty = true // 页面重新渲染为空\r\n        }else {\r\n            // 不要每次都调用get方法，get方法会非常消耗性能\r\n            queueWatcher(this);\r\n            // this.get() // 重新渲染\r\n        }\r\n    }\r\n\r\n    run() {\r\n        // 再一次取值，为修改之后的\r\n        let newValue = this.get();\r\n        // 第一次取值之后保留的\r\n        let oldValue = this.value;\r\n        this.value = newValue\r\n        if (this.user){\r\n            this.cb.call(this.vm, newValue, oldValue)\r\n        }\r\n    }\r\n\r\n    addDep(dep) {\r\n        let id = dep.id\r\n        if (!this.depsId.has(id)) {\r\n            this.deps.push(dep)\r\n            this.depsId.add(id)\r\n            dep.addSub(this)\r\n        }\r\n    }\r\n\r\n    evaluate(){\r\n        this.value = this.get()\r\n        this.dirty = false\r\n    }\r\n\r\n    depend(){\r\n        // 计算属性watcher会存储dep\r\n        // 通过watcher找到对应的所有Dep\r\n        let i = this.deps.length\r\n        while(i --){\r\n            this.deps[i].depend()\r\n        }\r\n    }\r\n}\r\n\r\n// 将需要批量更新的watcher放到一个队列中，稍后watcher执行\r\nlet queue = []\r\nlet has = {};\r\nlet pending = false\r\n\r\nfunction flushSchedulerQueue() {\r\n    queue.forEach(watcher => {\r\n        watcher.run();\r\n        if (!watcher.user){\r\n            watcher.cb()\r\n        }\r\n    })\r\n    queue = []\r\n    has = {}\r\n    pending = false\r\n}\r\n\r\nfunction queueWatcher(watcher) {\r\n    const id = watcher.id\r\n    if (has[id] == null) {\r\n        queue.push(watcher)\r\n        has[id] = true\r\n\r\n        // 等待所有代码同步完毕后执行\r\n        if (!pending) { // 防抖处理\r\n            nextTick(flushSchedulerQueue)\r\n            pending = true\r\n        }\r\n    }\r\n}\r\n\r\nexport default Watcher\r\n","import {observe} from \"./observer/index\";\r\nimport {nextTick, proxy} from \"./utils\";\r\nimport Watcher from \"./observer/watcher\";\r\nimport Dep from \"./observer/dep\";\r\n\r\nexport function initState(vm) {\r\n    const  opts = vm.$options;\r\n\r\n    if (opts.props) {\r\n        initProps(vm);\r\n    }\r\n    if (opts.methods) {\r\n        initMethod(vm);\r\n    }\r\n    if (opts.data) {\r\n        initData(vm);\r\n    }\r\n    if (opts.computed) {\r\n        initComputed(vm);\r\n    }\r\n    if (opts.watch) {\r\n        initWatch(vm);\r\n    }\r\n}\r\n\r\nfunction initProps(vm) {\r\n\r\n}\r\n\r\nfunction initMethod(vm) {\r\n\r\n}\r\n\r\nfunction initData(vm) {\r\n    let data = vm.$options.data\r\n    vm._data = data =  typeof data == 'function' ? data.call(vm) : data;\r\n    // 数据的劫持方案 对象Object.defineProperty\r\n    // 数组 单独处理\r\n\r\n    // 当从vm上取值时，将属性代理到vm._data上面\r\n    // 对vm做代理\r\n    for (let key in data) {\r\n        proxy(vm, '_data', key);\r\n    }\r\n    observe(data)\r\n}\r\n\r\nfunction initComputed(vm) {\r\n    let computed = vm.$options.computed\r\n    // 需要watcher defineProperty dirty\r\n    const watchers = vm._computedWatchers = {}\r\n    for (let key in computed) {\r\n        const userDef = computed[key]\r\n        const getter = typeof userDef == 'function' ? userDef : userDef.get;\r\n        watchers[key] = new Watcher(vm, getter, ()=>{}, {lazy: true})\r\n        defineComputed(vm, key, userDef)\r\n    }\r\n}\r\n\r\nfunction defineComputed(target, key, userDef){\r\n    const sharedPropertyDefinition = {\r\n        enumerable: true,\r\n        configurable: true,\r\n        get: ()=>{},\r\n        set: ()=>{}\r\n    }\r\n    if (typeof userDef == 'function'){\r\n        sharedPropertyDefinition.get = createComputedGetter(key)\r\n    }else {\r\n        sharedPropertyDefinition.get = createComputedGetter(key)\r\n        sharedPropertyDefinition.set = userDef.set\r\n    }\r\n    Object.defineProperty(target, key, sharedPropertyDefinition)\r\n}\r\n\r\nfunction createComputedGetter(key){\r\n    return function (){ // 这个方法是我们包装的方法\r\n        const watcher = this._computedWatchers[key]\r\n        if (watcher){\r\n            if (watcher.dirty){ // 判断是否需要执行用户传递的方法\r\n                // 执行\r\n                watcher.evaluate()\r\n            }\r\n            if (Dep.target){\r\n                watcher.depend()\r\n            }\r\n            return watcher.value\r\n        }\r\n    }\r\n}\r\n\r\nfunction initWatch(vm) {\r\n    let watch = vm.$options.watch\r\n    for (let key in watch){\r\n        const handler = watch[key]\r\n        if (Array.isArray(handler)){\r\n            handler.forEach(handle => {\r\n                createWatcher(vm, key, handle)\r\n            })\r\n        }else {\r\n            createWatcher(vm, key, handler) // 对象 字符串 函数\r\n        }\r\n    }\r\n}\r\n\r\nfunction createWatcher(vm, exprOrFn, handler, options){ // options可以用来标识用户watcher\r\n    if (typeof handler == 'object'){\r\n        options = handler\r\n        handler = handler.handler\r\n    }\r\n    if (typeof handler == 'string'){\r\n        handler = vm.$options.methods[handler]\r\n    }\r\n    // key handler options\r\n    return vm.$watch(exprOrFn, handler, options)\r\n}\r\n\r\nexport function stateMixin(Vue){\r\n    Vue.prototype.$nextTick = function (cb) {\r\n        nextTick(cb)\r\n    }\r\n    Vue.prototype.$watch = function (exprOrFn, cb, options) {\r\n        // 数据应该依赖这个watcher 数据变化后应该让这个watcher重新执行\r\n        let watcher = new Watcher(this, exprOrFn, cb, {...options, user: true});\r\n        if (options && options.immediate){\r\n            cb()\r\n        }\r\n    }\r\n}\r\n","// let ast = {\r\n//     tag: \"div\",\r\n//     parent: null,\r\n//     type: 1,\r\n//     attrs: [],\r\n//     children: [{\r\n//         tag: null,\r\n//         parent: \"parent div\",\r\n//         attrs: [],\r\n//         text: \"hello {{name}}\"\r\n//     },{\r\n//\r\n//     }]\r\n// }\r\n// <div id=\"app\">hello {{name}} <span>world</span></div>\r\n\r\nconst ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`; // abc-aaa 匹配标签名\r\n// ?:匹配不捕获\r\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`; // <aaa:asdads>\r\nconst startTagOpen = new RegExp(`^<${qnameCapture}`); // 标签开头的正则 捕获的内容是标签名\r\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`); // 匹配标签结尾的 </div>\r\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/; // 匹配属性的\r\nconst startTagClose = /^\\s*(\\/?)>/; // 匹配标签结束的 >  <div>\r\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g  // {{}}\r\n\r\n// 通过树和栈\r\nfunction createASTElement(tagName, attrs){\r\n    return {\r\n        tag: tagName, // 标签名\r\n        type: 1, // 元素类型\r\n        children: [], // 孩子列表\r\n        attrs,  // 属性集合\r\n        parent: null  // 父元素\r\n    }\r\n}\r\n\r\n// 因为效率很低， 所以在开发部署的时候打包为最终的代码\r\nexport function parseHTML(html) {\r\n    let root;\r\n    let currentParent;\r\n    let stack = []\r\n    // 检验标签是否符合规则\r\n    function start(tagName, attrs){\r\n        let element = createASTElement(tagName, attrs)\r\n        if (!root){\r\n            root = element;\r\n        }\r\n        currentParent = element;\r\n        stack.push(element)\r\n    }\r\n\r\n    function end(tagName){ // 结尾标签处创建父子关系\r\n        let element = stack.pop()\r\n        currentParent = stack[stack.length - 1]\r\n        if (currentParent){ // 在闭合时可以知道这个标签的父标签\r\n            element.parent = currentParent\r\n            currentParent.children.push(element)\r\n        }\r\n    }\r\n    function chars(text){\r\n        text = text.trim()\r\n        if (text){\r\n            currentParent.children.push({\r\n                type: 3,\r\n                text\r\n            })\r\n        }\r\n    }\r\n\r\n\r\n    while (html){\r\n        let textEnd = html.indexOf('<');\r\n        if (textEnd === 0) {\r\n            // this is a tag, not a text\r\n            const startTagMatch = parseStartTag();\r\n            if (startTagMatch){\r\n                start(startTagMatch.tagName, startTagMatch.attrs)\r\n                continue\r\n            }\r\n            const endTagMatch = html.match(endTag);\r\n            if (endTagMatch){\r\n                advance(endTagMatch[0].length)\r\n                end(endTagMatch[1]);\r\n                continue\r\n            }\r\n\r\n            //TODO: v-bind ... <!DOCTYPE <!---> <br/>\r\n        }\r\n        // text\r\n        let text;\r\n        if (textEnd > 0){\r\n            text = html.substring(0, textEnd)\r\n            advance(text.length)\r\n            chars(text)\r\n        }\r\n    }\r\n\r\n    function advance(n){ // sub string\r\n        html = html.substring(n)\r\n    }\r\n\r\n    function parseStartTag(){\r\n        const start = html.match(startTagOpen);\r\n        if (start) {\r\n            const match = {\r\n                tagName: start[1],\r\n                attrs: []\r\n            }\r\n            advance(start[0].length) // delete start tag\r\n            // is end tag\r\n            let end;\r\n            let attr;\r\n            while (!(end = html.match(startTagClose)) && (attr = html.match(attribute))){\r\n                match.attrs.push({\r\n                    name: attr[1],\r\n                    value: attr[3] || attr[4] || attr[5]\r\n                })\r\n                advance(attr[0].length)\r\n            }\r\n            if (end){\r\n                advance(end[0].length)\r\n            }\r\n            return match\r\n        }\r\n    }\r\n\r\n    return root\r\n}","// <div id=\"app\" style=\"color: red\"> hello {{name}} <span>hello</span></div>\r\n// render(){\r\n//  return _c('div', {id: 'app', style: {color: 'red'}}, _v('hello' + _s(name)), _c('span', null, _v('hello')))\r\n// }\r\n// 元素 _c(tagName, attrs, element...)\r\n// 文本 _v(text)\r\n// 变量 _s(valueName)\r\n\r\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g  // {{}}\r\n\r\n// name: \"id\"\r\n// value: \"app\"\r\nfunction genProps(attrs) {\r\n    let str = ''\r\n    for (let i = 0; i < attrs.length; i++) {\r\n        let attr = attrs[i]\r\n        if (attr.name === 'style'){\r\n            let obj = {}\r\n            attr.value.replace(/\\s/g, '').split(\";\").forEach(item => {\r\n                let [key, value] = item.split(\":\")\r\n                obj[key] = value\r\n            })\r\n            attr.value = obj\r\n        }\r\n        str += `${attr.name}:${JSON.stringify(attr.value)},`\r\n    }\r\n    return `{${str.slice(0, -1)}}`\r\n}\r\n\r\nfunction gen(node) {\r\n    if (node.type === 1) return generate(node)\r\n    else {\r\n        let text = node.text;\r\n        // normal text\r\n        // _v(\"hello {{name}}\") => _v('hello ' + _s(name))\r\n        if (! defaultTagRE.test(text)){\r\n            return `_v(${JSON.stringify(text)})` // 需要对{{}}处理\r\n        }\r\n        let tokens = [] // 存放每一段代码\r\n        let lasIndex = defaultTagRE.lastIndex = 0; // 如果正则是全局模式，需要每次使用前置为0\r\n        let match, index; // 每次匹配到的结果\r\n        while(match = defaultTagRE.exec(text)){\r\n            index = match.index // 保存匹配到的索引\r\n            if (index > lasIndex){\r\n                tokens.push(JSON.stringify(text.slice(lasIndex, index)))\r\n            }\r\n            tokens.push(`_s(${match[1].trim()})`);\r\n            lasIndex = index + match[0].length\r\n        }\r\n        if (lasIndex < text.length) tokens.push(JSON.stringify(text.slice(lasIndex)));\r\n        return `_v(${tokens.join('+')})`\r\n    }\r\n}\r\n\r\nfunction getChildren(el) {\r\n    const children = el.children\r\n    if (children){ // 将所有转化后的child用,拼接\r\n        return children.map(child => gen(child)).join(',')\r\n    }\r\n}\r\n\r\nexport function generate(el) {\r\n    let children = getChildren(el)\r\n    let code = `_c('${el.tag}', ${\r\n        el.attrs.length ? `${genProps(el.attrs)}` : 'undefined'\r\n    }${\r\n        children? `,${children}` : ''\r\n    })`\r\n\r\n    return code\r\n}","import {parseHTML} from \"./parse\";\r\nimport {generate} from \"./generate\";\r\n\r\nexport function compilerToFunctions(template) {\r\n    // html template => render\r\n    // use ast to describe language, use ast product code\r\n    // virtual dom can describe grammar, but ast describe structure\r\n    // html -> ast -> render\r\n\r\n    // 1. html -> ats\r\n    let ast = parseHTML(template)\r\n    console.log(ast)\r\n    // 2. 优化静态节点\r\n\r\n    // 3. 通过这棵树，重新生成代码 -> render\r\n    let code = generate(ast);\r\n\r\n    // 4. 将字符串变为函数\r\n    // 通过with来限制取值范围，当调用时，能保证取到值\r\n    let render = new Function(`with(this){return ${code}}`);\r\n    return render\r\n}","export function patch(oldVnode, vnode){\r\n    // 默认初始化时 直接用虚拟节点创建出真实节点 替换掉老节点\r\n    if (oldVnode.nodeType === 1){\r\n        // 将虚拟节点转化为真实节点\r\n        console.log(oldVnode, vnode)\r\n        let el = createElm(vnode) // #app\r\n        let parentElm = oldVnode.parentNode;\r\n        // nextSibling下一个兄弟节点\r\n        parentElm.insertBefore(el, oldVnode.nextSibling) // 将当前真实元素插入到app后面\r\n        parentElm.removeChild(oldVnode)\r\n\r\n        return el\r\n    }else {\r\n        // 在更新时 拿老虚拟节点和新的虚拟节点做对比 将不同的地方更新真实的dom\r\n        // 既有渲染功能 也有更新功能\r\n        // 1. 比较两个元素的标签 标签不一样直接替换掉即可\r\n        if (oldVnode.tag !== vnode.tag) {\r\n            oldVnode.el.parentNode.replaceChild(createElm(vnode), oldVnode.el)\r\n            return vnode.el = oldVnode.el\r\n        }\r\n        // 2. 标签一样，文本节点的虚拟节点tag都为undefined\r\n        // 文本对比\r\n        if (!oldVnode.tag) {\r\n            if (oldVnode.text !== vnode.text) {\r\n                oldVnode.el.textContent = vnode.text\r\n                return vnode.el = oldVnode.el\r\n            }\r\n        }\r\n        // 3. 标签相同并且必须开始比对标签的属性和儿子\r\n        // 标签相同最好直接复用\r\n        let el = vnode.el = oldVnode.el // 复用老节点\r\n        // 更新属性: 用新的虚拟节点的属性和老的比较\r\n        updateProperties(vnode, oldVnode.data);\r\n\r\n        // 比较孩子\r\n        let oldChildren = oldVnode.children || [];\r\n        let newChildren = vnode.children || []\r\n        // 老的有孩子节点 新的也有孩子节点 diff算法\r\n        if (oldChildren.length > 0 && newChildren.length > 0){\r\n            updateChildren(oldChildren, newChildren, el)\r\n        }else if (oldChildren.length > 0 ){ // 老的有孩子节点 新的没有孩子节点\r\n            el.innerHTML = ''\r\n        }else if (newChildren.length > 0){  // 老的没有孩子节点 新的有孩子节点\r\n            for (let i = 0; i < newChildren.length; i++) {\r\n                let child = newChildren[i]\r\n                // 浏览器存在性能优化，不需要处理文档碎片\r\n                el.appendChild(createElm(child))\r\n            }\r\n        }\r\n        return el\r\n    }\r\n}\r\n\r\n// 儿子间的比较\r\nfunction updateChildren(oldChildren, newChildren, parent){\r\n    // vue中的diff算法做了很多优化\r\n    // dom中操作有很多常见的逻辑 将节点插入到孩子的头部、尾部、儿子倒叙正序\r\n    // vue2中采用的是双指针的方式\r\n\r\n    // 在尾部添加\r\n    // 4指针 比较\r\n    let oldStartIndex = 0\r\n    let oldStartVnode = oldChildren[oldStartIndex]\r\n    let oldEndIndex = oldChildren.length - 1\r\n    let oldEndVnode = oldChildren[oldEndIndex]\r\n\r\n    let newStartIndex = 0\r\n    let newStartVnode = newChildren[newStartIndex]\r\n    let newEndIndex = newChildren.length - 1\r\n    let newEndVnode = newChildren[newEndIndex]\r\n\r\n    function makeIndexByKey(children){\r\n        let map = {}\r\n        children.forEach((item, index)=>{\r\n            if (item.key){\r\n                map[item.key] = index\r\n            }\r\n        })\r\n        return map\r\n    }\r\n    let map = makeIndexByKey(oldChildren)\r\n    // 比较谁先循环完毕 停止\r\n    while(oldStartIndex <= oldEndIndex && newStartIndex <= newEndIndex) {\r\n        if (!oldStartVnode){\r\n            oldStartVnode = oldChildren[++oldStartIndex]\r\n        }else if (!oldEndVnode){\r\n            oldEndVnode = oldChildren[--oldEndIndex]\r\n        }else if (isSameVnode(oldStartVnode, newStartVnode)) { // oldStartIndex newStartIndex 如果两个是相同元素 对比孩子节点\r\n            patch(oldStartVnode, newStartVnode) // 更新属性 递归更新子节点\r\n            oldStartVnode = oldChildren[++oldStartIndex]\r\n            newStartVnode = newChildren[++newStartIndex]\r\n        } else if (isSameVnode(oldEndVnode, newEndVnode)) {\r\n            patch(oldEndVnode, newEndVnode)\r\n            oldEndVnode = oldChildren[--oldEndIndex]\r\n            newEndVnode = newChildren[--newEndIndex]\r\n        } else if (isSameVnode(oldStartVnode, newEndVnode)) { // 反转节点\r\n            patch(oldStartVnode, newEndVnode)\r\n            parent.insertBefore(oldStartVnode.el, oldEndVnode.el.nextSibling);\r\n            oldStartVnode = oldChildren[++oldStartIndex]\r\n            newEndVnode = newChildren[--newEndIndex]\r\n        } else if (isSameVnode(oldEndVnode, newStartVnode)) {\r\n            patch(oldEndVnode, newStartVnode)\r\n            parent.insertBefore(oldEndVnode.el, oldStartVnode.el)\r\n            oldEndVnode = oldChildren[--oldEndIndex];\r\n            newStartVnode = newChildren[++newStartIndex]\r\n        }else {\r\n            // 孩子之间没有关系 暴力对比\r\n            // 防止数组塌陷 需要置空\r\n            let moveIndex = map[newStartVnode.key];\r\n            if (moveIndex === undefined) { // 没有可以复用的\r\n                parent.insertBefore(createElm(newStartVnode), oldStartVnode.el)\r\n            }else {\r\n                let moveVNode = oldChildren[moveIndex];\r\n                oldChildren[moveIndex] = null\r\n                parent.insertBefore(moveVNode.el, oldStartVnode.el)\r\n                patch(moveVNode, newStartVnode) // 更新属性和孩子\r\n            }\r\n            newStartVnode = newChildren[++newStartIndex]\r\n        }\r\n\r\n        // 循环的时候不能用index作为key\r\n        // old element\r\n        // <li key=\"1\">1</li>\r\n        // <li key=\"2\">2</li>\r\n        // <li key=\"3\">3</li>\r\n        // reverse => after transform => static index有问题\r\n        // <li key=\"1\">3</li>\r\n        // <li key=\"2\">2</li>\r\n        // <li key=\"3\">1</li>\r\n        // 反转实际上是移位复用，但是使用key作为index后，根据标签复用\r\n        // 如果没有id可以随机生成\r\n    }\r\n    if (newStartIndex <= newEndIndex){\r\n        for (let i = newStartIndex; i <= newEndIndex; i++) {\r\n            // parent.appendChild(createElm(newChildren[i]))\r\n            // 向后插入ele为null\r\n            // 向前插入ele为当前向谁的前面插入\r\n            let ele = newChildren[newEndIndex + 1] == null ? null : newChildren[newEndIndex + 1].el;\r\n            parent.insertBefore(createElm(newChildren[i]), ele)\r\n        }\r\n    }\r\n    if (oldStartIndex <= oldEndIndex){\r\n        for (let i = oldStartIndex; i <= oldEndIndex; i++) {\r\n            let child = oldChildren[i]\r\n            if (child !== null){ // 如果为null，这个节点已经被处理过，pass\r\n                parent.removeChild(child.el)\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n// 标签相同 key相同 但是属性不相同是有可能的 这种情况只需要更新属性即可\r\nfunction isSameVnode(oldVnode, newVnode){\r\n    return (oldVnode.tag === newVnode.tag) && (oldVnode.key === newVnode.key)\r\n}\r\n\r\nexport function createElm(vnode){\r\n    let {tag, children, key, data, text} = vnode\r\n    if (typeof tag == 'string'){\r\n        // vnode.el可以用来更新\r\n        vnode.el = document.createElement(tag)\r\n        // 只有元素才有属性\r\n        updateProperties(vnode)\r\n        children.forEach(child => {\r\n            vnode.el.appendChild(createElm(child))\r\n        })\r\n    }else {\r\n        vnode.el = document.createTextNode(text)\r\n    }\r\n    return vnode.el\r\n}\r\n\r\nfunction updateProperties(vnode, oldProps = {}) {\r\n    let newProps = vnode.data || {}\r\n    let el = vnode.el\r\n    // 老的有 新的没有 删除属性\r\n    for (let key in oldProps) {\r\n        if (!newProps[key]) {\r\n            el.removeAttribute(key)\r\n        }\r\n    }\r\n    // 新的有 直接用新的来更新\r\n\r\n    // 样式处理 style={color: red} => style={background: red}\r\n    let newStyle = newProps.style || {}\r\n    let oldStyle = oldProps.style || {}\r\n    for (let key in  oldStyle){\r\n        if (!newStyle[key]){\r\n            el.style[key] = ''\r\n        }\r\n    }\r\n    // 没有的属性直接删除\r\n    // 有的属性直接替换或增加\r\n\r\n    for (let key in newProps) {\r\n        if (key === 'style') {\r\n            for (let styleName in newProps.style) {\r\n                el.style[styleName] = newProps.style[styleName];\r\n            }\r\n        } else if (key === 'class') {\r\n            el.className = newProps.class;\r\n        } else {\r\n            el.setAttribute(key, newProps[key]);\r\n        }\r\n    }\r\n}\r\n","import {patch} from \"./vdom/patch\";\r\nimport Watcher from \"./observer/watcher\";\r\n\r\nexport function lifecycleMixin(Vue){\r\n    Vue.prototype._update = function (vnode){\r\n        const vm = this\r\n        const preVnode = vm._vnode\r\n        if (!preVnode){\r\n            // 用新的创建的元素替换掉原来的元素\r\n            vm.$el = patch(vm.$el, vnode);\r\n        }else {\r\n            vm.$el = patch(preVnode, vnode)\r\n        }\r\n        vm._vnode = vnode // 保存了vnode\r\n    }\r\n}\r\n\r\nexport function mountComponent(vm, el) {\r\n    vm.$el = el\r\n    // 调用render方法来渲染el属性\r\n\r\n    // 先调用render方法创建虚拟节点，再将虚拟节点渲染到页面上\r\n    // _render render => vnode\r\n    // _update vnode render to html\r\n\r\n    callHook(vm, 'beforeMount')\r\n    let updateComponent = () => {\r\n        vm._update(vm._render());\r\n    }\r\n    // watcher是用来渲染的\r\n    // true表示渲染watcher\r\n    let watcher = new Watcher(vm, updateComponent, ()=>{\r\n        callHook(vm, 'updated')\r\n    }, true)\r\n    // 将属性和watcher绑定在一起\r\n    callHook(vm, 'mounted')\r\n}\r\n\r\n// template -> ast -> render function (transform to vnode) -> vnode -> html\r\n// vue渲染流程: 初始化数据 -> 初始化数据 -> 将模板编译 -> render函数 -> 生成虚拟节点 -> 生成真实dom -> html\r\n\r\n\r\nexport function callHook(vm, hook){\r\n    const handlers = vm.$options[hook]\r\n    if (handlers){\r\n        for (let i = 0; i < handlers.length; i++) {\r\n            // 保证用户生命周期里面的this为当前实例\r\n            handlers[i].call(vm);\r\n        }\r\n    }\r\n}\r\n","import {initState} from \"./state\";\r\nimport {compilerToFunctions} from \"./compiler/index\";\r\nimport {callHook, mountComponent} from \"./lifecycle\";\r\nimport {mergeOptions} from \"./utils\";\r\n\r\nexport function initMixin(Vue) {\r\n    Vue.prototype._init = function (options) {\r\n        const vm = this;\r\n\r\n        // 将用户传递的和全局的合并\r\n        // 这个方法可能会被子组件来调用, 子组件来调用Vue不为全局，而为继承之后的\r\n        vm.$options = mergeOptions(vm.constructor.options, options);\r\n\r\n        callHook(vm, 'beforeCreate')\r\n\r\n        // vue里面核心特征，响应式数据原理\r\n        // 初始化状态\r\n        initState(vm)\r\n\r\n        callHook(vm, 'created')\r\n\r\n        // 渲染逻辑 el === vm.$mount() 最终$mount来挂载\r\n        if (vm.$options.el){\r\n            vm.$mount(vm.$options.el)\r\n        }\r\n    };\r\n\r\n    Vue.prototype.$mount = function (el) {\r\n        const vm = this\r\n        el = document.querySelector(el);\r\n\r\n        const options = vm.$options;\r\n        if (!options.render){\r\n            // no render, template to render\r\n            let template = options.template;\r\n            // no render and has el, use el\r\n            if (!template && el){\r\n                template = el.outerHTML;\r\n            }\r\n            // compile template (from origin template or el)\r\n            const render = compilerToFunctions(template);\r\n            // finally use render\r\n            options.render = render\r\n        }\r\n        // has render\r\n\r\n        // 需要挂载组件\r\n        mountComponent(vm, el);\r\n    }\r\n}","\r\nexport function renderMixin(Vue){\r\n    // 虚拟节点，用对象来描述dom\r\n    Vue.prototype._c = function () { // 创建元素\r\n        return createElement(...arguments)\r\n    }\r\n\r\n    Vue.prototype._s = function (val) { // stringify\r\n        // JSON.stringify(val)会导致所有元素节点进行依赖收集\r\n        return val == null ? '' : (typeof val === 'object') ? JSON.stringify(val) : val;\r\n    }\r\n\r\n    Vue.prototype._v = function (text) { // 创建文本元素\r\n        return createTextVnode(text)\r\n    }\r\n\r\n    Vue.prototype._render = function (){\r\n        const vm = this\r\n        const render = vm.$options.render\r\n        let vnode = render.call(vm)\r\n        return vnode\r\n    }\r\n}\r\n\r\n//  return _c('div', {id: 'app', style: {color: 'red'}}, _v('hello' + _s(name)), _c('span', null, _v('hello')))\r\n\r\nfunction createElement(tag, data = {}, ...children) {\r\n    return vnode(tag, data, data.key, children, undefined)\r\n}\r\n\r\nfunction createTextVnode(text){\r\n    return vnode(undefined, undefined, undefined, undefined,text)\r\n}\r\n\r\n// 操作正式dom消耗性能，vnode可以只更新不同，复用相同\r\nfunction vnode(tag, data, key, children, text){\r\n    // ast不用自定义属性\r\n    return {\r\n        tag,\r\n        data,\r\n        key,\r\n        children,\r\n        text,\r\n        // componentsInstance: ''\r\n        // 可以自定义描述对象\r\n    };\r\n}","import {mergeOptions} from \"../utils\";\r\n\r\nexport function initGlobalAPI(Vue){\r\n    Vue.options = {}\r\n\r\n    Vue.mixin = function (mixin){\r\n        // 如何实现两个对象的合并\r\n        this.options = mergeOptions(this.options, mixin)\r\n    }\r\n    // 生命周期的合并策略\r\n    // 生命周期必须合并为一个数组，而不是覆盖\r\n}","import {initMixin} from \"./init\";\r\nimport {lifecycleMixin} from \"./lifecycle\";\r\nimport {renderMixin} from \"./vdom/index\";\r\nimport {initGlobalAPI} from \"./initGlobalAPI/index\";\r\nimport {stateMixin} from \"./state\";\r\n\r\nfunction Vue(options) {\r\n    this._init(options); //入口方法，做初始化操作\r\n}\r\n\r\n// 写成一个个插件进行原型扩展\r\n\r\ninitMixin(Vue)\r\nlifecycleMixin(Vue) // 混合生命周期\r\nrenderMixin(Vue)\r\nstateMixin(Vue)\r\n\r\n// 初始化全局API\r\ninitGlobalAPI(Vue)\r\n\r\n\r\n\r\n// differ算法测试\r\n// import {compilerToFunctions} from \"./compiler/index\";\r\n// import {createElm, patch} from \"./vdom/patch\"\r\n// let vm1 = new Vue({\r\n//     data: {\r\n//         name: \"vm1---\"\r\n//     }\r\n// })\r\n// let render1 = compilerToFunctions(`<div>\r\n//     <li key=\"C\" style=\"background-color: aquamarine\">C</li>\r\n//     <li key=\"E\" style=\"background-color: red\">E</li>\r\n//     <li key=\"D\" style=\"background-color: blue\">D</li>\r\n// </div>`)\r\n// let vnode1 = render1.call(vm1)\r\n// document.body.appendChild(createElm(vnode1))\r\n//\r\n// let vm2 = new Vue({\r\n//     data: {\r\n//         name: \"vm2---\"\r\n//     }\r\n// })\r\n// let render2 = compilerToFunctions(`<div>\r\n//     <li key=\"A\" style=\"background-color: yellow\">A</li>\r\n//     <li key=\"D\" style=\"background-color: red\">D</li>\r\n//     <li key=\"E\" style=\"background-color: blue\">E</li>\r\n//     <li key=\"F\" style=\"background-color: blue\">F</li>\r\n// </div>`)\r\n// let vnode2 = render2.call(vm2)\r\n//\r\n// setTimeout(()=>{\r\n//     patch(vnode1, vnode2)\r\n// }, 3000)\r\n\r\nexport default Vue\r\n"],"names":["oldArrayMethods","Array","prototype","arrayMethods","Object","create","methods","forEach","method","args","console","log","result","apply","arguments","inserted","ob","__ob__","slice","observeArray","dep","notify","proxy","vm","data","key","defineProperty","get","set","newValue","value","enumerable","configurable","writable","LIFECYCLE_HOOKS","strats","mergeHook","parentVal","childVal","concat","hook","mergeOptions","parent","child","options","mergeField","hasOwnProperty","callbacks","flushCallbacks","length","cb","pop","pending","timerFunc","Promise","resolve","then","MutationObserver","observe","textNode","document","createTextNode","characterData","textContent","setImmediate","setTimeout","nextTick","push","id","Dep","subs","target","addDep","watcher","update","stack","pushTarget","popTarget","Observer","isArray","__proto__","walk","keys","defineReactive","item","childDep","depend","Watcher","exprOrFn","user","isWatcher","deps","depsId","Set","lazy","dirty","getter","path","split","obj","i","call","queueWatcher","oldValue","has","add","addSub","queue","flushSchedulerQueue","run","initState","opts","$options","props","initData","computed","initComputed","watch","initWatch","_data","watchers","_computedWatchers","userDef","defineComputed","sharedPropertyDefinition","createComputedGetter","evaluate","handler","handle","createWatcher","$watch","stateMixin","Vue","$nextTick","immediate","ncname","qnameCapture","startTagOpen","RegExp","endTag","attribute","startTagClose","createASTElement","tagName","attrs","tag","type","children","parseHTML","html","root","currentParent","start","element","end","chars","text","trim","textEnd","indexOf","startTagMatch","parseStartTag","endTagMatch","match","advance","substring","n","attr","name","defaultTagRE","genProps","str","replace","JSON","stringify","gen","node","generate","test","tokens","lasIndex","lastIndex","index","exec","join","getChildren","el","map","code","compilerToFunctions","template","ast","render","Function","patch","oldVnode","vnode","nodeType","createElm","parentElm","parentNode","insertBefore","nextSibling","removeChild","replaceChild","updateProperties","oldChildren","newChildren","updateChildren","innerHTML","appendChild","oldStartIndex","oldStartVnode","oldEndIndex","oldEndVnode","newStartIndex","newStartVnode","newEndIndex","newEndVnode","makeIndexByKey","isSameVnode","moveIndex","undefined","moveVNode","ele","newVnode","createElement","oldProps","newProps","removeAttribute","newStyle","style","oldStyle","styleName","className","setAttribute","lifecycleMixin","_update","preVnode","_vnode","$el","mountComponent","callHook","updateComponent","_render","handlers","initMixin","_init","constructor","$mount","querySelector","outerHTML","renderMixin","_c","_s","val","_v","createTextVnode","initGlobalAPI","mixin"],"mappings":"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"}